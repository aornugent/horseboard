# Backend Server (Node.js/Express)

This backend server, built with Node.js and Express.js, acts as the intermediary between the Google TV display client and the mobile controller app. For the MVP, it uses an in-memory data store.

## Core Responsibilities
1.  Facilitate pairing between the mobile app and a Google TV display.
2.  Store and serve table data for displays.
3.  Receive table data updates from the mobile app.

## Development Setup

### Prerequisites
*   **Node.js:** Ensure Node.js (LTS version recommended) is installed. Download from [nodejs.org](https://nodejs.org/).
*   **npm:** A JavaScript package manager, included with Node.js.

### Project Setup
1.  **Navigate to the backend directory:**
    ```bash
    cd backend
    ```
2.  **Install Dependencies:**
    ```bash
    npm install
    ```
    Key dependencies (as per `package.json`):
    *   `express`: Web framework.
    *   `cors` (if you added it for different origin testing, though not strictly in current `package.json` unless `npm install express` added it as a sub-dependency or if it was there before). The current `package.json` lists `express` as the primary direct dependency installed by the agent.

### Running the Server
*   **Development Mode (with auto-restart if nodemon is installed and configured):**
    The current `package.json` includes `nodemon` as a dev dependency and a `dev` script:
    ```bash
    npm run dev
    ```
*   **Basic Start:**
    ```bash
    npm start
    ```
    (Uses the `start` script: `"start": "node server.js"`)

The server will run on `http://localhost:3000` by default.

## Project Structure (Current MVP)

```
backend/
├── src/                # Placeholder, not strictly used in current simple server.js
│   ├── api/
│   │   └── .gitkeep
│   ├── services/
│   │   └── .gitkeep
│   └── store/
│       └── .gitkeep
├── .gitignore
├── package.json
├── package-lock.json
├── server.js           # Main server entry point, Express app setup, and all API logic for MVP
└── README.md
```
The `AGENTS.md` file suggests a more elaborate structure (`src/api/routes.js`, etc.), but for the current MVP, all logic resides in `server.js`.

## API Endpoints

### 1. `POST /pair`
*   **Request Body:** `{ "displayId": "123456" }` (JSON)
*   **Functionality:** Acknowledges a pairing attempt from the mobile app. For MVP, it mainly serves to confirm the mobile app is trying to connect to a specific `displayId`. It doesn't strictly create a persistent pairing state beyond logging.
*   **Response:** Success or error message (JSON). Example: `{ "message": "Pairing request for 123456 acknowledged..." }`

### 2. `PUT /display/{displayId}`
*   **URL Parameter:** `displayId` (e.g., `123456`)
*   **Request Body:** `{ "tableData": { "headers": ["H1"], "rows": [["C1"]] } }` (JSON)
*   **Functionality:** Overwrites or creates the `tableData` for the given `displayId` in the in-memory store.
*   **Response:** Success or error message (JSON). Example: `{ "message": "Data for display 123456 updated successfully." }`

### 3. `GET /display/{displayId}`
*   **URL Parameter:** `displayId` (e.g., `123456`)
*   **Functionality:** Retrieves the current `tableData` for the given `displayId`. If the `displayId` is not found, it returns a default structure indicating "Display Not Found".
*   **Response:** The `tableData` JSON object or a default/error structure.
    *   **Success Example:** `{ "headers": ["Name", "Age"], "rows": [["Alice", 30]] }`
    *   **Not Found Example:** `{ "headers": ["Status"], "rows": [["Display Not Found or No Data Yet"]] }`

## In-Memory Data Store (in `server.js`)

A simple JavaScript object (`displays`) in `server.js` is used to store display data for the MVP.

**Example Structure within `server.js`:**
```javascript
const displays = {
  // "displayId" (e.g., a 6-digit code generated by TV app) is the key
  "123456": { // Example displayId
    tableData: {
      headers: ["Default Header"],
      rows: [["Default Cell"]]
    }
  },
  "display123": { // Hardcoded example for initial backend testing
    tableData: {
      headers: ["Name", "Age", "City"],
      rows: [
        ["Alice", 30, "New York"],
        ["Bob", 24, "San Francisco"]
      ]
    }
  }
  // More displays can be added dynamically by PUT requests
};
```

## Future Enhancements (Post-MVP)
*   **Database Integration:** Replace in-memory store with a persistent database.
*   **Real-time Communication:** Implement WebSockets for instant updates to the TV.
*   **Refactor to `src/` structure:** Move API logic, services, and store management to separate files under `src/` as complexity grows.

This README reflects the current state of the MVP.
