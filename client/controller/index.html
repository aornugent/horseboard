<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#4a90d9">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Board Controller</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Pairing Screen -->
  <div id="pairing-screen" class="screen">
    <div class="pairing-content">
      <h1>Enter the code shown on your TV</h1>
      <div class="code-inputs" id="code-inputs">
        <input type="text" inputmode="numeric" pattern="[0-9]" maxlength="1" class="code-digit" data-index="0" autocomplete="off">
        <input type="text" inputmode="numeric" pattern="[0-9]" maxlength="1" class="code-digit" data-index="1" autocomplete="off">
        <input type="text" inputmode="numeric" pattern="[0-9]" maxlength="1" class="code-digit" data-index="2" autocomplete="off">
        <input type="text" inputmode="numeric" pattern="[0-9]" maxlength="1" class="code-digit" data-index="3" autocomplete="off">
        <input type="text" inputmode="numeric" pattern="[0-9]" maxlength="1" class="code-digit" data-index="4" autocomplete="off">
        <input type="text" inputmode="numeric" pattern="[0-9]" maxlength="1" class="code-digit" data-index="5" autocomplete="off">
      </div>
      <p id="pairing-error" class="error hidden">Invalid code. Please try again.</p>
      <button id="connect-btn" class="btn btn-primary" disabled>Connect</button>
    </div>
  </div>

  <!-- Loading Screen -->
  <div id="loading-screen" class="screen hidden">
    <div class="loading-content">
      <div class="spinner"></div>
      <p>Connecting...</p>
    </div>
  </div>

  <!-- Editor Screen -->
  <div id="editor-screen" class="screen hidden">
    <header class="editor-header">
      <button id="back-btn" class="btn btn-icon" title="Disconnect">
        <span class="icon">&#x2190;</span>
      </button>
      <h1 id="header-title">Feed Board</h1>
      <button id="save-btn" class="btn btn-primary btn-small">Save</button>
    </header>

    <!-- Tab Navigation -->
    <nav class="tab-bar">
      <button class="tab-btn active" data-tab="board">Board</button>
      <button class="tab-btn" data-tab="horses">Horses</button>
      <button class="tab-btn" data-tab="feeds">Feeds</button>
      <button class="tab-btn" data-tab="reports">Reports</button>
    </nav>

    <!-- Tab Content -->
    <main class="tab-content">
      <!-- Board Tab -->
      <div id="tab-board" class="tab-panel active">
        <div class="board-controls">
          <div class="time-mode-toggle">
            <button class="mode-btn" data-mode="AM">AM</button>
            <button class="mode-btn active" data-mode="AUTO">Auto</button>
            <button class="mode-btn" data-mode="PM">PM</button>
          </div>
          <div class="zoom-controls">
            <button id="zoom-out" class="btn btn-icon" title="Zoom out">−</button>
            <span id="zoom-level">7 horses</span>
            <button id="zoom-in" class="btn btn-icon" title="Zoom in">+</button>
          </div>
        </div>
        <div class="board-grid-container">
          <div id="board-grid" class="board-grid">
            <!-- Grid will be rendered by JS -->
          </div>
        </div>
        <div class="pagination-controls">
          <button id="page-prev" class="btn btn-icon" disabled>‹</button>
          <span id="page-indicator">Page 1 of 1</span>
          <button id="page-next" class="btn btn-icon" disabled>›</button>
        </div>
      </div>

      <!-- Horses Tab -->
      <div id="tab-horses" class="tab-panel">
        <div class="horses-list" id="horses-list">
          <!-- Horse cards will be rendered by JS -->
        </div>
        <button id="add-horse-btn" class="btn btn-add btn-add-row">+ Add Horse</button>
      </div>

      <!-- Feeds Tab -->
      <div id="tab-feeds" class="tab-panel">
        <div class="feeds-list" id="feeds-list">
          <!-- Feed items will be rendered by JS -->
        </div>
        <button id="add-feed-btn" class="btn btn-add btn-add-row">+ Add Feed</button>
      </div>

      <!-- Reports Tab -->
      <div id="tab-reports" class="tab-panel">
        <div class="reports-container">
          <h2>Weekly Consumption</h2>
          <table id="reports-table" class="reports-table">
            <thead>
              <tr>
                <th>Feed</th>
                <th>Weekly Total</th>
                <th>Unit</th>
              </tr>
            </thead>
            <tbody id="reports-body">
              <!-- Report rows will be rendered by JS -->
            </tbody>
          </table>
        </div>
      </div>
    </main>

    <!-- Status bar -->
    <footer class="editor-footer">
      <span id="status-text">Ready</span>
    </footer>
  </div>

  <!-- Quantity Input Modal -->
  <div id="quantity-modal" class="modal hidden">
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h2 id="quantity-title">Edit Quantity</h2>
        <button class="modal-close-btn btn btn-icon">&times;</button>
      </div>
      <div class="quantity-input-container">
        <input type="number" id="quantity-input" step="0.25" min="0" placeholder="0">
        <span id="quantity-unit">scoops</span>
      </div>
      <div class="quantity-presets">
        <button class="preset-btn" data-value="0.25">¼</button>
        <button class="preset-btn" data-value="0.5">½</button>
        <button class="preset-btn" data-value="0.75">¾</button>
        <button class="preset-btn" data-value="1">1</button>
        <button class="preset-btn" data-value="1.5">1½</button>
        <button class="preset-btn" data-value="2">2</button>
      </div>
      <div class="modal-actions">
        <button class="btn clear-qty-btn">Clear</button>
        <button class="btn btn-primary save-qty-btn">Done</button>
      </div>
    </div>
  </div>

  <!-- Note Edit Modal -->
  <div id="note-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Edit Note</h2>
        <button class="modal-close-btn btn btn-icon">&times;</button>
      </div>
      <div class="note-horse-name" id="note-horse-name"></div>
      <textarea id="note-input" rows="3" placeholder="Enter note..."></textarea>
      <div class="note-expiry-row">
        <label>Auto-clear:</label>
        <select id="note-expiry-select">
          <option value="">Never</option>
          <option value="24">After 24 hours</option>
          <option value="48">After 48 hours</option>
        </select>
      </div>
      <div class="modal-actions">
        <button class="btn modal-cancel-btn">Cancel</button>
        <button class="btn btn-primary save-note-btn">Save</button>
      </div>
    </div>
  </div>

  <!-- Horse Detail Modal -->
  <div id="horse-modal" class="modal hidden">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2 id="horse-modal-title">Horse Details</h2>
        <button class="modal-close-btn btn btn-icon">&times;</button>
      </div>
      <div class="horse-name-row">
        <label>Name:</label>
        <input type="text" id="horse-name-input" placeholder="Horse name">
      </div>
      <div class="horse-clone-row">
        <label>Clone diet from:</label>
        <select id="clone-diet-select">
          <option value="">-- Select horse --</option>
        </select>
      </div>
      <div class="horse-note-section">
        <label>Note:</label>
        <textarea id="horse-note-input" rows="2" placeholder="Optional note..."></textarea>
        <div class="note-expiry-row">
          <label>Auto-clear:</label>
          <select id="horse-note-expiry">
            <option value="">Never</option>
            <option value="24">After 24 hours</option>
            <option value="48">After 48 hours</option>
          </select>
        </div>
        <div id="stale-note-warning" class="warning hidden">Note is over 24h old without expiry set</div>
      </div>
      <div class="horse-feeds-section">
        <h3>Active Feeds</h3>
        <div id="horse-active-feeds" class="horse-feeds-list">
          <!-- Active feeds rendered by JS -->
        </div>
        <h3>Add Feed</h3>
        <div id="horse-inactive-feeds" class="horse-feeds-list inactive">
          <!-- Inactive feeds rendered by JS -->
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-danger delete-horse-btn">Delete Horse</button>
        <button class="btn btn-primary save-horse-btn">Save</button>
      </div>
    </div>
  </div>

  <!-- Feed Edit Modal -->
  <div id="feed-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="feed-modal-title">Edit Feed</h2>
        <button class="modal-close-btn btn btn-icon">&times;</button>
      </div>
      <div class="feed-name-row">
        <label>Name:</label>
        <input type="text" id="feed-name-input" placeholder="Feed name">
      </div>
      <div class="feed-unit-row">
        <label>Unit:</label>
        <select id="feed-unit-select">
          <option value="scoop">Scoop</option>
          <option value="ml">ml</option>
          <option value="biscuit">Biscuit</option>
          <option value="sachet">Sachet</option>
        </select>
      </div>
      <div class="modal-actions">
        <button class="btn btn-danger delete-feed-btn hidden">Delete</button>
        <button class="btn modal-cancel-btn">Cancel</button>
        <button class="btn btn-primary save-feed-btn">Save</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="delete-modal" class="modal hidden">
    <div class="modal-content modal-small">
      <h2 id="delete-title">Delete?</h2>
      <p id="delete-message">This action cannot be undone.</p>
      <div class="modal-actions">
        <button id="delete-cancel" class="btn">Cancel</button>
        <button id="delete-confirm" class="btn btn-danger">Delete</button>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast hidden"></div>

  <!-- Install Prompt Banner -->
  <div id="install-banner" class="install-banner hidden">
    <span>Install Board Controller for quick access</span>
    <button id="install-btn" class="btn btn-small btn-primary">Install</button>
    <button id="dismiss-install" class="btn btn-icon">&times;</button>
  </div>

  <script src="app.js"></script>
  <script>
    // Register service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/controller/sw.js')
        .then((reg) => console.log('Service worker registered:', reg.scope))
        .catch((err) => console.log('Service worker registration failed:', err));
    }
  </script>
</body>
</html>
